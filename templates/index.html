{% extends "layout.html" %}

{% block title %}View Collection{% endblock %}

{% block content %}
    <h2>Collection Overview</h2>

    <form action="{{ url_for('find_missing_covers_route') }}" method="post" style="margin-bottom: 1em;">
        <button type="submit">Find & Download Missing Covers</button>
    </form>

    {% if collection %}
        <ul class="record-list">
            {% for record in collection %}
                <li>
                    {% if record.cover_path and record.cover_path != 'None' %}
                        {# Construct the URL using the prefix and the filename part of the path #}
                        {% set cover_filename = record.cover_path.split('/')[-1].split('\\')[-1] %}
                        <img src="{{ covers_prefix }}{{ cover_filename }}" alt="{{ record.album }} Cover" width="100" style="float: right; margin-left: 15px; border: 1px solid #eee;">
                    {% else %}
                         <img src="{{ url_for('static', filename='placeholder.png') }}" alt="No Cover" width="100" style="float: right; margin-left: 15px; border: 1px solid #eee; opacity: 0.5;">
                    {% endif %}

                    <strong>Artist:</strong> {{ record.artist or 'N/A' }}<br>
                    <strong>Album:</strong> {{ record.album or 'N/A' }}<br>
                    <strong>Genre:</strong> {{ record.genre or 'N/A' }}<br>
                    <strong>Year:</strong> {{ record.year or 'N/A' }}<br>
                    <strong>Format:</strong> {{ record.format or 'N/A' }}<br>
                    {% if record.notes %}
                        <strong>Notes:</strong> {{ record.notes }}<br>
                    {% endif %}
                    <div style="clear: both; margin-top: 10px;">
                        <a href="{{ url_for('edit_record_route', index=loop.index0) }}" class="button edit">Edit</a>
                        <form action="{{ url_for('delete_record_route', index=loop.index0) }}" method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this record?');">
                            <button type="submit" class="button delete">Delete Record</button>
                        </form>
                        {% if record.cover_path and record.cover_path != 'None' %}
                        <form action="{{ url_for('delete_cover_route', index=loop.index0) }}" method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete ONLY the cover file for this record?');">
                            <button type="submit" class="button delete-cover">Delete Cover Only</button>
                        </form>
                        {% endif %}
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Your collection is empty.</p>
    {% endif %}
{% endblock %}
